# 💬 实时对话记录功能使用指南

## 🎯 功能概述

实时对话记录功能允许您在前端界面中与心理咨询系统进行实时交互，所有对话都会被记录并在界面上实时显示。

## ✅ 功能特性

### 🔄 实时记录
- **即时显示**: 用户输入的消息会立即显示在对话日志中
- **自动滚动**: 新消息会自动滚动到可视区域
- **时间戳记**: 每条消息都有精确的时间标记
- **角色区分**: 用户消息、系统回复、情绪分析分别用不同样式显示

### 😊 情绪追踪
- **实时分析**: 每条用户消息都会进行情绪分析
- **可视化显示**: 情绪结果以彩色标签形式展示
- **置信度显示**: 显示情绪识别的可信程度
- **趋势更新**: 情绪数据会实时更新到趋势图表中

### 📊 数据同步
- **自动保存**: 对话数据会自动保存到用户历史记录中
- **图表联动**: 情绪图表会随着新对话实时更新
- **统计更新**: 情绪统计面板会显示最新分析结果

## 🖥️ 使用步骤

### 1. 访问界面
打开浏览器访问：
```
http://localhost:8080/emotion_dashboard.html
```

### 2. 展开功能面板
- 在页面顶部找到控制区域
- 点击 **"⚡ API调用"** 按钮
- 展开高级功能面板

### 3. 定位对话区域
在展开的面板中找到：
```
💬 实时对话模拟
├── 对话日志显示区 (上方)
├── 消息输入框 (下方左侧)
└── 📤 发送按钮 (下方右侧)
```

### 4. 开始对话
1. 在输入框中输入您的消息
2. 点击 **"📤 发送"** 按钮 **或** 按 **回车键**
3. 观察对话日志区域的实时更新

## 📝 对话日志格式

### 用户消息
```
[14:30:25] 👤 用户: 你好，我最近感觉压力很大
```

### 系统回复
```
[14:30:28] 🤖 系统: 你好，我能感受到你最近承受的压力...
```

### 情绪分析
```
[14:30:28] 😊 情绪: 焦虑 (置信度: 85.2%)
```

## 🎨 界面元素说明

### 对话日志区域
- **高度**: 200px，支持垂直滚动
- **背景**: 浅灰色，便于阅读
- **字体**: 等宽字体，代码风格显示
- **自动滚动**: 新消息自动滚动到底部

### 消息输入框
- **宽度**: 占据70%的水平空间
- **提示文字**: "输入对话内容..."
- **焦点样式**: 蓝色边框高亮

### 发送按钮
- **宽度**: 占据25%的水平空间
- **颜色**: 蓝绿色主题
- **悬停效果**: 颜色加深

## 🔧 技术实现细节

### 前端功能
```javascript
// 发送消息的核心函数
async function sendChatMessage() {
    // 1. 获取用户输入
    // 2. 添加到本地日志显示
    // 3. 发送到后端API
    // 4. 接收并显示系统回复
    // 5. 显示情绪分析结果
    // 6. 自动滚动日志区域
    // 7. 更新情绪图表
}
```

### 后端API集成
```python
# 主要API端点
POST /ask  # 处理对话并返回情绪分析
GET /emotion/chart/{user_id}  # 获取情绪趋势数据
POST /emotion/analyze  # 单独的情绪分析
```

### 数据流
```
用户输入 → 前端验证 → API调用 → 后端处理 
→ 情绪分析 → 系统回复 → 前端显示 → 图表更新
```

## 📊 实时更新机制

### 对话日志更新
- **即时添加**: 用户消息发送后立即显示
- **异步处理**: 系统回复通过异步方式添加
- **样式区分**: 不同类型消息有不同的CSS样式

### 情绪图表更新
- **延迟刷新**: 对话完成后1秒自动刷新图表
- **增量更新**: 只更新新增的数据点
- **平滑动画**: 图表变化有过渡效果

### 统计面板更新
- **实时计算**: 基于最新数据重新计算统计
- **颜色编码**: 根据情绪状态使用不同颜色
- **风险预警**: 自动检测异常情绪模式

## 💡 使用技巧

### 最佳实践
1. **连续对话**: 可以进行多轮连续对话来观察情绪变化趋势
2. **情绪表达**: 尽量使用带有明确情感色彩的表达方式
3. **耐心等待**: 系统回复需要几秒钟时间，请耐心等待
4. **查看历史**: 可以通过切换用户ID查看不同用户的对话历史

### 故障排除
- **消息不显示**: 检查网络连接和后端服务状态
- **情绪无变化**: 确认输入内容包含明确的情绪表达
- **图表不更新**: 点击"刷新数据"按钮手动更新
- **发送按钮无效**: 检查输入框是否为空

## 🚀 高级功能

### 批量测试
使用"🎲 生成测试数据"功能可以快速生成多条测试对话，便于观察情绪变化模式。

### 数据分析
- 观察情绪波动的规律性
- 分析不同话题对情绪的影响
- 识别情绪恢复的时间特征
- 发现潜在的心理健康风险信号

### 自定义场景
可以根据不同需求创建特定的对话场景：
- 职场压力测试
- 人际关系分析
- 学习焦虑评估
- 生活适应性检测

## 🔒 注意事项

- 所有对话数据都会被记录用于分析
- 请勿输入涉及隐私的敏感信息
- 系统仅供测试和演示使用
- 情绪分析结果仅供参考，不能替代专业心理诊断

---
*💡 提示: 实时对话功能已经过充分测试，可以稳定使用。如遇问题，请查看浏览器控制台的错误信息。*