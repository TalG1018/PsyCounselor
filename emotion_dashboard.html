<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç»ªåˆ†æä»ªè¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #333;
        }
        .emotion-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .anger { background-color: #ff6b6b; }
        .disgust { background-color: #8b4513; }
        .fear { background-color: #999999; }
        .joy { background-color: #4ecdc4; }
        .sadness { background-color: #45b7d1; }
        .surprise { background-color: #ff9ff3; }
        .neutral { background-color: #cccccc; }
        .controls {
            margin-bottom: 20px;
            text-align: center;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        .api-panel {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .api-panel .card {
            margin-bottom: 20px;
        }
        textarea, input[type="text"] {
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: inherit;
        }
        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
        }
        .emotion-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .user-message {
            background: #d1ecf1;
            border-left: 3px solid #0c5460;
        }
        .system-response {
            background: #d4edda;
            border-left: 3px solid #155724;
        }
        .emotion-log {
            background: #fff3cd;
            border-left: 3px solid #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ˜Š å¿ƒç†å’¨è¯¢æƒ…ç»ªåˆ†æä»ªè¡¨æ¿</h1>
            <p>å®æ—¶ç›‘æµ‹å’Œåˆ†æç”¨æˆ·æƒ…ç»ªå˜åŒ–è¶‹åŠ¿</p>
        </div>

        <div class="controls">
            <input type="text" id="userId" placeholder="è¯·è¾“å…¥ç”¨æˆ·ID" value="user_default">
            <button onclick="loadEmotionData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button onclick="showApiPanel()">âš¡ APIè°ƒç”¨</button>
        </div>
        
        <!-- APIè°ƒç”¨é¢æ¿ -->
        <div id="apiPanel" class="api-panel" style="display: none;">
            <div class="card">
                <h3>âš¡ å®æ—¶æƒ…ç»ªåˆ†æ</h3>
                <textarea id="textInput" placeholder="è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬å†…å®¹..." rows="3" style="width: 100%; padding: 10px; margin: 10px 0;"></textarea>
                <button onclick="analyzeText()" style="background: #28a745;">ğŸ¯ åˆ†ææƒ…ç»ª</button>
                <div id="analysisResult" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; display: none;"></div>
            </div>
            
            <div class="card">
                <h3>ğŸ“Š æ‰¹é‡æ•°æ®ç”Ÿæˆ</h3>
                <button onclick="generateTestData()" style="background: #ffc107; color: #212529;">ğŸ² ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
                <button onclick="clearUserData()" style="background: #dc3545;">ğŸ—‘ï¸ æ¸…ç©ºç”¨æˆ·æ•°æ®</button>
                <div id="batchResult" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; display: none;"></div>
            </div>
            
            <div class="card">
                <h3>ğŸ’¬ å®æ—¶å¯¹è¯æ¨¡æ‹Ÿ</h3>
                <div id="conversationLog" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace;"></div>
                <input type="text" id="chatInput" placeholder="è¾“å…¥å¯¹è¯å†…å®¹..." style="width: 70%; padding: 8px;">
                <button onclick="sendChatMessage()" style="width: 25%; background: #17a2b8;">ğŸ“¤ å‘é€</button>
            </div>
        </div>

        <div id="alert" class="alert alert-warning"></div>

        <div class="chart-container">
            <canvas id="emotionChart"></canvas>
        </div>

        <div class="legend" id="chartLegend"></div>

        <div class="info-panel">
            <div class="card">
                <h3>ğŸ“Š æƒ…ç»ªç»Ÿè®¡</h3>
                <div id="emotionStats">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <h3>ğŸ“ˆ è¶‹åŠ¿åˆ†æ</h3>
                <div id="trendAnalysis">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <h3>âš ï¸ é£é™©è¯„ä¼°</h3>
                <div id="riskAssessment">åŠ è½½ä¸­...</div>
            </div>
            <div class="card">
                <h3>ğŸ“… æœ€æ–°è®°å½•</h3>
                <div id="latestRecord">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        let emotionChart = null;
        const emotionColors = {
            0: '#cccccc', // ä¸­æ€§
            1: '#ff6b6b', // æ„¤æ€’
            2: '#8b4513', // åŒæ¶
            3: '#999999', // ææƒ§
            4: '#4ecdc4', // å¿«ä¹
            5: '#45b7d1', // æ‚²ä¼¤
            6: '#ff9ff3'  // æƒŠè®¶
        };

        const emotionNames = {
            0: 'ä¸­æ€§',
            1: 'æ„¤æ€’',
            2: 'åŒæ¶',
            3: 'ææƒ§',
            4: 'å¿«ä¹',
            5: 'æ‚²ä¼¤',
            6: 'æƒŠè®¶'
        };

        function showAlert(message, type = 'warning') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function createLegend() {
            const legendContainer = document.getElementById('chartLegend');
            legendContainer.innerHTML = '';
            
            Object.entries(emotionNames).forEach(([key, name]) => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <span class="emotion-indicator" style="background-color: ${emotionColors[key]}"></span>
                    ${name}
                `;
                legendContainer.appendChild(item);
            });
        }

        function createChart(data) {
            const ctx = document.getElementById('emotionChart').getContext('2d');
            
            if (emotionChart) {
                emotionChart.destroy();
            }

            emotionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(point => `ç¬¬${point.x}æ¬¡`),
                    datasets: [{
                        label: 'æƒ…ç»ªå˜åŒ–',
                        data: data.map(point => ({
                            x: point.x,
                            y: point.y
                        })),
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: data.map(point => emotionColors[point.y]),
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç”¨æˆ·æƒ…ç»ªå˜åŒ–è¶‹åŠ¿å›¾',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = data[context.dataIndex];
                                    return [
                                        `æƒ…ç»ª: ${point.emotion}`,
                                        `ç½®ä¿¡åº¦: ${(point.confidence * 100).toFixed(1)}%`,
                                        `æ—¶é—´: ${point.timestamp}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 6,
                            ticks: {
                                callback: function(value) {
                                    return emotionNames[value] || '';
                                }
                            },
                            title: {
                                display: true,
                                text: 'æƒ…ç»ªç±»åˆ«'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å¯¹è¯è½®æ¬¡'
                            }
                        }
                    }
                }
            });
        }

        async function loadEmotionData() {
            const userId = document.getElementById('userId').value || 'user_default';
            
            try {
                const response = await fetch(`http://localhost:8001/emotion/chart/${userId}`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    // æ›´æ–°å›¾è¡¨
                    createChart(result.data);
                    createLegend();
                    
                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    document.getElementById('emotionStats').innerHTML = `
                        <p>æ€»å¯¹è¯æ¬¡æ•°: <strong>${result.total_records}</strong></p>
                        <p>æœ€æ–°æƒ…ç»ª: <span class="emotion-indicator" style="background-color: ${emotionColors[result.data[result.data.length-1]?.y || 0]}"></span><strong>${result.latest_emotion}</strong></p>
                    `;
                    
                    // æ›´æ–°è¶‹åŠ¿åˆ†æ
                    document.getElementById('trendAnalysis').innerHTML = `
                        <p>è¶‹åŠ¿åˆ¤æ–­: <strong>${result.trend_analysis}</strong></p>
                        <p>æ•°æ®å®Œæ•´æ€§: ${result.total_records >= 3 ? 'âœ… å……è¶³' : 'âš ï¸ æ•°æ®è¾ƒå°‘'}</p>
                    `;
                    
                    // æ›´æ–°é£é™©è¯„ä¼°
                    const riskLevel = result.risk_alert ? 'âš ï¸ éœ€è¦å…³æ³¨' : 'âœ… æƒ…ç»ªç¨³å®š';
                    const riskColor = result.risk_alert ? '#ff6b6b' : '#4ecdc4';
                    document.getElementById('riskAssessment').innerHTML = `
                        <p style="color: ${riskColor}">é£é™©ç­‰çº§: <strong>${riskLevel}</strong></p>
                        ${result.risk_alert ? '<p>å»ºè®®åŠæ—¶è¿›è¡Œä¸“ä¸šå¿ƒç†å¹²é¢„</p>' : '<p>å½“å‰æƒ…ç»ªçŠ¶æ€è‰¯å¥½</p>'}
                    `;
                    
                    // æ›´æ–°æœ€æ–°è®°å½•
                    if (result.data.length > 0) {
                        const latest = result.data[result.data.length - 1];
                        document.getElementById('latestRecord').innerHTML = `
                            <p>æ—¶é—´: ${latest.timestamp}</p>
                            <p>æƒ…ç»ª: <span class="emotion-indicator" style="background-color: ${emotionColors[latest.y]}"></span>${latest.emotion}</p>
                            <p>ç½®ä¿¡åº¦: ${(latest.confidence * 100).toFixed(1)}%</p>
                        `;
                    }
                    
                    if (result.risk_alert) {
                        showAlert('æ£€æµ‹åˆ°æƒ…ç»ªå¼‚å¸¸ï¼Œè¯·å…³æ³¨ç”¨æˆ·å¿ƒç†å¥åº·çŠ¶å†µï¼', 'warning');
                    }
                    
                } else if (result.status === 'no_data') {
                    showAlert('è¯¥ç”¨æˆ·æš‚æ— æƒ…ç»ªè®°å½•æ•°æ®', 'warning');
                    document.getElementById('emotionStats').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                    document.getElementById('trendAnalysis').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                    document.getElementById('riskAssessment').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                    document.getElementById('latestRecord').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                }
            } catch (error) {
                console.error('åŠ è½½æƒ…ç»ªæ•°æ®å¤±è´¥:', error);
                showAlert('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨è¿æ¥', 'warning');
            }
        }

        // æ˜¾ç¤º/éšè—APIé¢æ¿
        function showApiPanel() {
            const panel = document.getElementById('apiPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        // å®æ—¶æƒ…ç»ªåˆ†æ
        async function analyzeText() {
            const text = document.getElementById('textInput').value.trim();
            const userId = document.getElementById('userId').value || 'user_default';
            const resultDiv = document.getElementById('analysisResult');
            
            if (!text) {
                showAlert('è¯·è¾“å…¥è¦åˆ†æçš„æ–‡æœ¬å†…å®¹', 'warning');
                return;
            }
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '<p>â³ åˆ†æä¸­...</p>';
                
                const response = await fetch('http://localhost:8001/emotion/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        text: text
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    const emotionColor = emotionColors[
                        Object.keys(emotionNames).find(key => emotionNames[key] === result.emotion)
                    ];
                    
                    resultDiv.innerHTML = `
                        <h4>ğŸ“Š åˆ†æç»“æœ</h4>
                        <p><strong>æƒ…ç»ª:</strong> <span class="emotion-tag" style="background-color: ${emotionColor}">${result.emotion}</span></p>
                        <p><strong>ç½®ä¿¡åº¦:</strong> ${(result.confidence * 100).toFixed(1)}%</p>
                        <p><strong>åˆ†ææ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
                        <details>
                            <summary>è¯¦ç»†æ¦‚ç‡åˆ†å¸ƒ</summary>
                            <ul>
                                ${Object.entries(result.all_probabilities)
                                  .map(([emotion, prob]) => `<li>${emotion}: ${(prob * 100).toFixed(1)}%</li>`)
                                  .join('')}
                            </ul>
                        </details>
                    `;
                    
                    // è‡ªåŠ¨åˆ·æ–°å›¾è¡¨
                    setTimeout(loadEmotionData, 1000);
                } else {
                    resultDiv.innerHTML = `<p style="color: red">âŒ åˆ†æå¤±è´¥: ${result.detail || 'æœªçŸ¥é”™è¯¯'}</p>`;
                }
            } catch (error) {
                console.error('æƒ…ç»ªåˆ†æå¤±è´¥:', error);
                resultDiv.innerHTML = `<p style="color: red">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // ç”Ÿæˆæµ‹è¯•æ•°æ®
        async function generateTestData() {
            const userId = document.getElementById('userId').value || 'user_default';
            const resultDiv = document.getElementById('batchResult');
            
            const testData = [
                "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå¿ƒæƒ…ç‰¹åˆ«æ„‰å¿«",
                "å·¥ä½œå‹åŠ›å¾ˆå¤§ï¼Œæ„Ÿè§‰å¾ˆç„¦è™‘",
                "å’Œæœ‹å‹èšä¼šå¾ˆå¼€å¿ƒï¼Œç¬‘å£°ä¸æ–­",
                "æœ€è¿‘æ€»æ˜¯å¤±çœ ï¼Œç²¾ç¥çŠ¶æ€å¾ˆå·®",
                "å®Œæˆäº†é‡è¦ä»»åŠ¡ï¼Œå¾ˆæœ‰æˆå°±æ„Ÿ",
                "å’Œå®¶äººåµæ¶äº†ï¼Œå¿ƒé‡Œå¾ˆéš¾å—"
            ];
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ² æ­£åœ¨ç”Ÿæˆæµ‹è¯•æ•°æ®...</p>';
            
            let successCount = 0;
            let totalCount = testData.length;
            
            for (let i = 0; i < testData.length; i++) {
                try {
                    await fetch('http://localhost:8001/ask', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            query: testData[i],
                            user_id: userId,
                            skip_crisis_check: true
                        })
                    });
                    successCount++;
                    resultDiv.innerHTML = `<p>ğŸ² æ­£åœ¨ç”Ÿæˆæµ‹è¯•æ•°æ®... (${successCount}/${totalCount})</p>`;
                    await new Promise(resolve => setTimeout(resolve, 500)); // å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
                } catch (error) {
                    console.error(`ç”Ÿæˆç¬¬${i+1}æ¡æ•°æ®å¤±è´¥:`, error);
                }
            }
            
            resultDiv.innerHTML = `
                <p style="color: green">âœ… æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆ!</p>
                <p>æˆåŠŸç”Ÿæˆ: ${successCount}/${totalCount} æ¡è®°å½•</p>
                <button onclick="loadEmotionData()" style="margin-top: 10px;">ğŸ”„ åˆ·æ–°å›¾è¡¨</button>
            `;
        }
        
        // æ¸…ç©ºç”¨æˆ·æ•°æ®
        async function clearUserData() {
            if (!confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰ç”¨æˆ·çš„æ‰€æœ‰æƒ…ç»ªæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                return;
            }
            
            const userId = document.getElementById('userId').value || 'user_default';
            const resultDiv = document.getElementById('batchResult');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ—‘ï¸ æ­£åœ¨æ¸…ç©ºæ•°æ®...</p>';
            
            try {
                // è¿™é‡Œå¯ä»¥é€šè¿‡è°ƒç”¨ç‰¹å®šçš„APIç«¯ç‚¹æ¥æ¸…ç©ºæ•°æ®
                // æˆ–è€…é‡æ–°åŠ è½½é¡µé¢æ¥é‡ç½®æ˜¾ç¤º
                localStorage.removeItem(`emotion_data_${userId}`);
                resultDiv.innerHTML = `
                    <p style="color: green">âœ… ç”¨æˆ·æ•°æ®å·²æ¸…ç©º</p>
                    <p>ç”¨æˆ·ID: ${userId}</p>
                    <button onclick="location.reload()" style="margin-top: 10px;">ğŸ”„ é‡æ–°åŠ è½½</button>
                `;
                
                // æ¸…ç©ºå›¾è¡¨æ˜¾ç¤º
                if (emotionChart) {
                    emotionChart.destroy();
                    emotionChart = null;
                }
                
                document.getElementById('emotionStats').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                document.getElementById('trendAnalysis').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                document.getElementById('riskAssessment').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                document.getElementById('latestRecord').innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red">âŒ æ¸…ç©ºå¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // å®æ—¶å¯¹è¯æ¨¡æ‹Ÿ
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            const userId = document.getElementById('userId').value || 'user_default';
            const logDiv = document.getElementById('conversationLog');
            
            if (!message) return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°æ—¥å¿—
            addToConversationLog('user', message);
            input.value = '';
            
            try {
                // å‘é€åˆ°åç«¯API
                const response = await fetch('http://localhost:8001/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: message,
                        user_id: userId
                    })
                });
                
                const result = await response.json();
                
                if (result.answer) {
                    // æ·»åŠ ç³»ç»Ÿå›å¤åˆ°æ—¥å¿—
                    addToConversationLog('system', result.answer);
                    
                    // æ˜¾ç¤ºæƒ…ç»ªåˆ†æç»“æœ
                    if (result.emotion) {
                        const emotionInfo = `æƒ…ç»ª: ${result.emotion} (${(result.confidence * 100).toFixed(1)}%)`;
                        addToConversationLog('emotion', emotionInfo);
                    }
                }
                
                // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                logDiv.scrollTop = logDiv.scrollHeight;
                
                // è‡ªåŠ¨åˆ·æ–°å›¾è¡¨
                setTimeout(loadEmotionData, 1000);
                
            } catch (error) {
                console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
                addToConversationLog('system', `âŒ å‘é€å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ·»åŠ å¯¹è¯æ—¥å¿—
        function addToConversationLog(type, content) {
            const logDiv = document.getElementById('conversationLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-message`;
            
            const timestamp = new Date().toLocaleTimeString();
            let prefix = '';
            
            switch(type) {
                case 'user':
                    prefix = 'ğŸ‘¤ ç”¨æˆ·';
                    break;
                case 'system':
                    prefix = 'ğŸ¤– ç³»ç»Ÿ';
                    break;
                case 'emotion':
                    prefix = 'ğŸ˜Š æƒ…ç»ª';
                    break;
            }
            
            entry.innerHTML = `<strong>[${timestamp}] ${prefix}:</strong> ${content}`;
            logDiv.appendChild(entry);
        }
        
        // å›è½¦é”®å‘é€æ¶ˆæ¯
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è·å–æ•°æ®
        window.addEventListener('DOMContentLoaded', function() {
            loadEmotionData();
        });
    </script>
</body>
</html>